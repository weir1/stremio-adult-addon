# Understanding and Fixing the "No addons were requested for this meta" Error

This document explains a common and recurring issue in Stremio addon development that results in the "No addons were requested for this meta" message, and provides a clear, step-by-step guide to resolving it.

## The Problem

When you click on an item in a Stremio catalog, the "Play" button is missing, and you see the message "No addons were requested for this meta." This means that the Stremio client did not ask any installed addon to provide streams for the selected content.

## The Cause

Stremio uses a routing system based on ID prefixes to determine which addon "owns" a piece of content. When a user selects an item from a catalog, Stremio does the following:

1.  It looks at the ID of the selected item (e.g., `x_aBcDeFg123` or `fansdb:4567`).
2.  It checks the `idPrefixes` array declared in the `meta` and `stream` resources of each installed addon's manifest.
3.  If the item's ID starts with a prefix advertised by an addon, Stremio sends a `meta` request to that addon.
4.  After receiving the metadata, Stremio "knows" that this addon is responsible for the content and will subsequently send a `stream` request to it when the user wants to play it.

The error occurs if **no addon advertises the correct ID prefix** for the selected item. Without a match, Stremio never sends the `meta` or `stream` requests, and the play button never appears.

This is especially common when using custom ID formats that are not based on IMDb (e.g., `tt123456`).

## The Solution

The fix involves ensuring that every custom ID generated by your addon is accounted for in the manifest's `idPrefixes`.

### Step 1: Identify All Custom ID Prefixes

Review your addon's code to find all the different formats of IDs you are creating. Look for any code that generates item IDs for the `meta` and `stream` handlers.

In this project, the prefixes are:
- `js_`: Used by the Jackett scraper.
- `x_`: Used by the 1337x scraper.
- `fansdb:`: Used for FansDB performers.
- `fansdb-scene:`: Used for scenes from FansDB performers.

### Step 2: Update the Manifest's `idPrefixes`

The `idPrefixes` must be declared in **both** the `meta` and `stream` resources within your manifest.

In this project, this is handled in `src/handlers/addonHandler.js`. Ensure the `idPrefixes` array contains all the prefixes you identified.

**Example (`src/handlers/addonHandler.js`):**
```javascript
class AddonHandler {
  constructor(userConfig = {}) {
    // ...
    const idPrefixes = ['js_', 'x_', 'fansdb:', 'fansdb-scene:']; // <-- All prefixes must be here
    const dynamicManifest = getManifest(idPrefixes);
    this.builder = new addonBuilder(dynamicManifest);
    this.setupHandlers();
  }
  // ...
}
```

### Step 3: Verify ID Generation in Scrapers

Ensure that the code that generates the IDs in your scrapers or services is actually adding the prefix.

**Example (`src/scrapers/1337x.js`):**
```javascript
generateTorrentId(name, link) {
    const cleanName = name.replace(/[^a-zA-Z0-9\s]/g, '').trim().replace(/\s+/g, '_');
    const cleanLink = link.replace(/[^a-zA-Z0-9]/g, '');
    const combined = cleanName + '_' + cleanLink;
    const hash = Buffer.from(combined).toString('base64').replace(/[^a-zA-Z0-9]/g, '').substring(0, 20);
    return `x_${hash}`; // <-- Ensure the prefix is added
}
```

### Step 4: Bump the Addon Version

To force the Stremio client to fetch the updated manifest, you **must** increment the version number.

1.  **`package.json`**:
    ```json
    "version": "1.5.7",
    ```
2.  **`src/config/manifest.js`**:
    ```javascript
    const getManifest = (idPrefixes = []) => ({
      // ...
      version: '1.5.7', // <-- Bump this version
      // ...
    });
    ```

After making these changes and restarting the addon, you will need to reinstall it in Stremio using the manifest URL to see the fix.
